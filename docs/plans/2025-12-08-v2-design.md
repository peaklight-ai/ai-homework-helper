# AI Homework Helper - Version 2 Design Document

**Author:** Chadi Abi Fadel
**Date:** 2025-12-08
**Status:** Approved for Implementation

---

## Overview

Version 2 addresses demo feedback (Nov 19, 2025) with bug fixes and three core features: student profiles, custom question upload, and expanded math domains.

### Design Philosophy
- **Minimalist** - Simple, focused UI
- **Easy to manipulate** - Students can use independently
- **Fun like ClassDojo** - Gamified experience

---

## Bug Fixes

### Bug 1: Input Blocked After Correct Answer
**Location:** `components/Conversation.tsx`
**Problem:** When `isComplete=true`, input is disabled but AI still asks follow-up questions.
**Fix:** On correct answer, immediately show celebration + "Try Another Problem" button. Remove follow-up question behavior.

### Bug 2: Overly Positive AI on Mistakes
**Location:** `lib/gemini.ts` (system prompt)
**Problem:** AI says "great start" even on wrong answers.
**Fix:** Update system prompt:
- Only praise correct reasoning
- For mistakes, use neutral redirects: "Let's think about this differently" or "What if we try another approach?"

### Bug 3: Topic Visibility
**Location:** `components/Conversation.tsx`
**Problem:** Shows "Topic: Addition" which gives away problem type.
**Fix:** Remove topic display from problem card. Keep internally for categorization.

---

## Feature 1: Student Profiles

### User Flow
1. First visit → "Create Your Profile" screen
2. Profile creation → Name, grade (1-6), pick avatar
3. Returning user → Auto-loads profile
4. Profile switcher → Dropdown for multiple profiles

### Data Model
```typescript
interface StudentProfile {
  id: string;
  name: string;
  grade: 1 | 2 | 3 | 4 | 5 | 6;
  avatarSeed: string; // For DiceBear
  createdAt: Date;
}

interface StudentProgress {
  profileId: string;
  totalXp: number;
  level: number;
  currentStreak: number;
  totalQuestions: number;
  correctAnswers: number;
}
```

### Technical Implementation
- **Storage:** Dexie.js (IndexedDB wrapper)
- **Avatars:** DiceBear API with fun cartoon styles
- **UI Location:** Top-right corner, click to open profile card

### Why Dexie.js over localStorage
| Concern | localStorage | Dexie.js |
|---------|-------------|----------|
| Data loss on cache clear | Lost forever | Still lost, but structured for backup |
| Storage limit | ~5MB strings only | ~50MB+ with objects |
| Querying | Manual JSON parsing | Native queries |
| React integration | Manual | `useLiveQuery` hook |

### Backup Feature
- "Export Profile" button → downloads JSON file
- "Import Profile" → restores from JSON
- Prompt users to backup after creating profile

---

## Feature 2: Custom Question Upload

### User Flow
1. Navigate to `/upload` page (or modal)
2. Fill form: question, answer, difficulty, optional hint
3. Select math domain from dropdown
4. Save → stored in Dexie.js
5. Questions appear in problem selection

### Data Model
```typescript
interface CustomProblem {
  id: string;
  question: string;
  answer: number;
  difficulty: 1 | 2 | 3 | 4 | 5;
  hint?: string;
  domain: MathDomain;
  gradeRange: [number, number]; // e.g., [1, 3] for grades 1-3
  createdBy: 'custom';
  createdAt: Date;
}

type MathDomain =
  | 'number-operations'
  | 'algebraic-thinking'
  | 'geometry'
  | 'measurement'
  | 'data-handling'
  | 'problem-solving';
```

### Form Fields
| Field | Type | Required |
|-------|------|----------|
| Question | textarea | Yes |
| Correct Answer | number | Yes |
| Difficulty | 1-5 stars | Yes |
| Domain | dropdown | Yes |
| Grade Range | multi-select | Yes |
| Hint | textarea | No |

### Future: Image Upload (V3)
- Tesseract.js for OCR
- Snap photo of homework → extract problem text
- Manual verification before saving

---

## Feature 3: Expanded Math Domains

### Domain Categories

#### 1. Number & Operations
- Counting and cardinality
- Place value
- Addition, subtraction, multiplication, division
- Fractions (grades 3+)
- Decimals (grades 5+)

#### 2. Algebraic Thinking
- Patterns and sequences
- Simple equations (find the missing number)
- Relationships between numbers

#### 3. Geometry
- Shapes and properties
- Symmetry
- Angles (basic)
- Perimeter and area (grades 4+)

#### 4. Measurement
- Length, weight, volume
- Time (reading clocks, elapsed time)
- Temperature
- Units and conversions

#### 5. Data Handling
- Reading tables and charts
- Bar graphs, pictographs
- Interpreting data

#### 6. Problem Solving
- Word problems
- Multi-step problems
- Logical reasoning

### Implementation
- Add 5-10 sample problems per domain in `lib/sampleProblems.ts`
- Tag problems with `domain` and `gradeRange`
- Filter problems based on student's grade level
- Update AI system prompt to handle non-numeric answers (geometry descriptions)

### Problem Structure
```typescript
interface MathProblem {
  id: string;
  question: string;
  answer: number | string; // string for geometry answers
  difficulty: 1 | 2 | 3 | 4 | 5;
  domain: MathDomain;
  gradeRange: [number, number];
  hints: string[];
  createdBy: 'system' | 'custom';
}
```

---

## Technical Architecture

### Storage Layer (Dexie.js)
```typescript
// lib/db.ts
import Dexie, { Table } from 'dexie';

export interface StudentProfile { /* ... */ }
export interface StudentProgress { /* ... */ }
export interface CustomProblem { /* ... */ }

export class HomeworkHelperDB extends Dexie {
  profiles!: Table<StudentProfile>;
  progress!: Table<StudentProgress>;
  customProblems!: Table<CustomProblem>;

  constructor() {
    super('HomeworkHelperDB');
    this.version(1).stores({
      profiles: '++id, name, grade',
      progress: '++id, profileId',
      customProblems: '++id, domain, difficulty'
    });
  }
}

export const db = new HomeworkHelperDB();
```

### Avatar Integration (DiceBear)
```typescript
// components/Avatar.tsx
function Avatar({ seed, size = 64 }: { seed: string; size?: number }) {
  const url = `https://api.dicebear.com/9.x/adventurer/svg?seed=${seed}&size=${size}`;
  return <img src={url} alt="Avatar" />;
}
```

### File Structure Changes
```
lib/
├── db.ts              # NEW: Dexie database setup
├── gemini.ts          # UPDATE: Fix overly positive AI
├── sampleProblems.ts  # UPDATE: Add domains, grade ranges
└── prisma.ts          # KEEP: For future server DB

components/
├── Conversation.tsx   # UPDATE: Fix bugs, integrate profiles
├── Avatar.tsx         # NEW: DiceBear avatar component
├── ProfileCard.tsx    # NEW: Profile display/switcher
├── ProfileForm.tsx    # NEW: Create/edit profile
└── QuestionForm.tsx   # NEW: Custom question upload

app/
├── page.tsx           # UPDATE: Profile integration
└── upload/
    └── page.tsx       # NEW: Question upload page
```

---

## Deployment

**No infrastructure changes required.**

| Component | Deployment |
|-----------|------------|
| Next.js app | Vercel (unchanged) |
| Dexie.js | Browser IndexedDB (no server) |
| DiceBear | Free HTTP API (no hosting) |
| AI (Gemini) | CometAPI (unchanged) |

---

## Success Criteria

- [ ] All 3 bugs fixed and verified
- [ ] Student can create profile with avatar
- [ ] Profile persists across browser sessions
- [ ] Teacher can upload custom questions
- [ ] Export/Import profile works
- [ ] Problems from all 6 math domains available
- [ ] Problems filter by student grade level

---

## Out of Scope (V3+)

- Server database / cross-device sync
- Teacher dashboard
- Parent portal
- Image OCR upload
- Voice input
- Multi-language support
- Badge/achievement system
- Leaderboards
